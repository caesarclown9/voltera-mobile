# –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ EvPower

**–î–∞—Ç–∞**: 2025-09-30
**–í–µ—Ä—Å–∏—è API**: 1.0
**–°—Ç–∞—Ç—É—Å**: Production Ready

---

## 1. WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ª–æ–∫–∞—Ü–∏–π/—Å—Ç–∞–Ω—Ü–∏–π

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ

**Endpoint**: `wss://ocpp.evpower.kg/api/v1/ws/locations?client_id=YOUR_CLIENT_ID`

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ö–æ–¥**: `/backend/app/api/v1/locations/websocket.py`

```typescript
// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
const ws = new WebSocket('wss://ocpp.evpower.kg/api/v1/ws/locations?client_id=YOUR_CLIENT_ID');

ws.onopen = () => {
  console.log('WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ –ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ª–æ–∫–∞—Ü–∏—é:
  ws.send(JSON.stringify({
    action: 'subscribe',
    channel: 'location:LOCATION_ID'
  }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('–ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:', data);

  switch (data.type) {
    case 'connection':
      // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
      console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ:', data.message);
      break;

    case 'location_status_update':
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ª–æ–∫–∞—Ü–∏–∏
      updateLocationStatus(data.data);
      break;

    case 'station_status_update':
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç–∞–Ω—Ü–∏–∏
      updateStationStatus(data.data);
      break;

    case 'subscription':
      // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏/–æ—Ç–ø–∏—Å–∫–∏
      console.log('–ü–æ–¥–ø–∏—Å–∫–∞:', data.status, data.channel);
      break;

    case 'pong':
      // –û—Ç–≤–µ—Ç –Ω–∞ ping
      console.log('Pong –ø–æ–ª—É—á–µ–Ω');
      break;

    case 'error':
      console.error('–û—à–∏–±–∫–∞ WebSocket:', data.message);
      break;
  }
};

ws.onerror = (error) => {
  console.error('WebSocket –æ—à–∏–±–∫–∞:', error);
};

ws.onclose = () => {
  console.log('WebSocket –æ—Ç–∫–ª—é—á–µ–Ω');
  // –†–µ–∞–ª–∏–∑—É–π—Ç–µ reconnect –ª–æ–≥–∏–∫—É —Å exponential backoff
  setTimeout(() => reconnect(), 5000);
};
```

### –§–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π

#### –û—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É:

```typescript
// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ –ª–æ–∫–∞—Ü–∏–∏
{
  "action": "subscribe",
  "channel": "all"
}

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ª–æ–∫–∞—Ü–∏—é
{
  "action": "subscribe",
  "channel": "location:EVP-LOC-001"
}

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å—Ç–∞–Ω—Ü–∏–∏ –ª–æ–∫–∞—Ü–∏–∏
{
  "action": "subscribe",
  "channel": "location_stations:EVP-LOC-001"
}

// –û—Ç–ø–∏—Å–∫–∞
{
  "action": "unsubscribe",
  "channel": "all"
}

// Ping –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
{
  "action": "ping"
}
```

#### –û—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É:

```typescript
// –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
{
  "type": "connection",
  "status": "connected",
  "client_id": "uuid-client-id",
  "message": "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º –ª–æ–∫–∞—Ü–∏–π"
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ª–æ–∫–∞—Ü–∏–∏
{
  "type": "location_status_update",
  "data": {
    "location_id": "EVP-LOC-001",
    "status": "available" | "occupied" | "offline" | "maintenance" | "partial",
    "available_connectors": 3,
    "total_connectors": 6,
    "stations_count": 2,
    "available_stations": 1,
    "occupied_stations": 1,
    "timestamp": "2025-09-30T12:00:00Z"
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç–∞–Ω—Ü–∏–∏
{
  "type": "station_status_update",
  "data": {
    "station_id": "EVP-001-01",
    "location_id": "EVP-LOC-001",
    "status": "available" | "occupied" | "offline" | "maintenance",
    "connectors": [
      {
        "connector_id": 1,
        "status": "Available" | "Charging" | "Occupied" | "Faulted",
        "power_kw": 22.0
      }
    ],
    "timestamp": "2025-09-30T12:00:00Z"
  }
}

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
{
  "type": "subscription",
  "status": "subscribed" | "unsubscribed",
  "channel": "location:EVP-LOC-001"
}

// Pong –æ—Ç–≤–µ—Ç
{
  "type": "pong",
  "timestamp": 1696073200.123
}

// –û—à–∏–±–∫–∞
{
  "type": "error",
  "message": "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON"
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ exponential backoff (5s, 10s, 20s, 40s, 60s max)
2. **Ping/Pong**: –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ ping –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–ª—É—á–∞–π —Ä–∞–∑—Ä—ã–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
5. **client_id**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Supabase User UUID

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSocket vs REST API

- **WebSocket**: –î–ª—è —ç–∫—Ä–∞–Ω–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π (real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤)
- **REST API**: –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏

---

## 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–π –º–µ–∂–¥—É Supabase –∏ OCPP —Å–µ—Ä–≤–µ—Ä–æ–º

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  OCPP –°—Ç–∞–Ω—Ü–∏—è   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  OCPP WebSocket  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ     Redis       ‚îÇ
‚îÇ   (–§–∏–∑–∏—á–µ—Å–∫–æ–µ   ‚îÇ  OCPP    ‚îÇ     –°–µ—Ä–≤–µ—Ä       ‚îÇ  Pub/Sub‚îÇ   (Real-time)   ‚îÇ
‚îÇ   —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)   ‚îÇ  1.6     ‚îÇ  (Backend)       ‚îÇ         ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ                            ‚îÇ
                                     ‚îÇ –û–±–Ω–æ–≤–ª—è–µ—Ç                  ‚îÇ
                                     ‚ñº                            ‚ñº
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ  Supabase        ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  WebSocket      ‚îÇ
                            ‚îÇ  PostgreSQL      ‚îÇ  –ß–∏—Ç–∞–µ—Ç ‚îÇ  –ö–ª–∏–µ–Ω—Ç—ã        ‚îÇ
                            ‚îÇ  (–û—Å–Ω–æ–≤–Ω–∞—è –ë–î)   ‚îÇ         ‚îÇ  (–ú–æ–±–∏–ª—å–Ω–æ–µ     ‚îÇ
                            ‚îÇ                  ‚îÇ         ‚îÇ   –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)   ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

1. **Heartbeat –æ—Ç —Å—Ç–∞–Ω—Ü–∏–π**: –ö–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
2. **StatusNotification**: –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞
3. **MeterValues**: –ö–∞–∂–¥—ã–µ 10-30 —Å–µ–∫—É–Ω–¥ –≤–æ –≤—Ä–µ–º—è –∑–∞—Ä—è–¥–∫–∏
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –ë–î**: –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ OCPP —Å–æ–æ–±—â–µ–Ω–∏–π
5. **–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞**: –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç heartbeat timeout (5 –º–∏–Ω—É—Ç)

### –ì–¥–µ –±—Ä–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

#### –î–ª—è —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π (List View):

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥ - –≥–∏–±—Ä–∏–¥–Ω—ã–π:**

```typescript
// 1. –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Supabase (–±—ã—Å—Ç—Ä–æ)
const { data: locations } = await supabase
  .from('locations')
  .select(`
    *,
    stations (
      id,
      serial_number,
      status,
      is_available,
      last_heartbeat_at,
      connectors (
        connector_number,
        status,
        connector_type,
        power_kw
      )
    )
  `)
  .eq('status', 'active');

// 2. –ü–æ–¥–∫–ª—é—á–∞–µ–º WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
const ws = new WebSocket('wss://ocpp.evpower.kg/api/v1/ws/locations?client_id=' + userId);

ws.onmessage = (event) => {
  const update = JSON.parse(event.data);
  if (update.type === 'location_status_update') {
    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π state
    updateLocationInList(update.data);
  }
};

// 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º Supabase Realtime –∫–∞–∫ fallback
const subscription = supabase
  .channel('locations-changes')
  .on('postgres_changes',
    { event: '*', schema: 'public', table: 'stations' },
    (payload) => {
      console.log('Station changed:', payload);
      refreshStationInList(payload.new.id);
    }
  )
  .subscribe();
```

#### –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞–Ω—Ü–∏–∏:

```typescript
// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏ - –í–°–ï–ì–î–ê –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º REST API
const response = await fetch(
  `https://ocpp.evpower.kg/api/v1/station/status/${stationId}`
);
const stationStatus = await response.json();

// stationStatus —Å–æ–¥–µ—Ä–∂–∏—Ç:
{
  "success": true,
  "station_id": "EVP-001-01",
  "is_online": true,
  "last_heartbeat": "2025-09-30T12:00:00Z",
  "connectors": [
    {
      "connector_id": 1,
      "status": "Available",
      "connector_type": "GBT",
      "power_kw": 22.0,
      "error_code": null
    }
  ],
  "current_sessions": [],
  "firmware_version": "1.2.3"
}

// –ó–∞—Ç–µ–º polling –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏
const pollInterval = setInterval(async () => {
  const updated = await fetch(
    `https://ocpp.evpower.kg/api/v1/station/status/${stationId}`
  );
  updateStationDetails(await updated.json());
}, 10000);
```

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

**–ö–æ–¥**: `/backend/app/services/location_status_service.py:25-67`

```python
def determine_location_status(
    available_stations: int,
    occupied_stations: int,
    offline_stations: int,
    maintenance_stations: int
) -> str:
    """
    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–≤:
    1. offline - –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ñ–ª–∞–π–Ω —Å—Ç–∞–Ω—Ü–∏–∏
    2. maintenance - –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞–Ω—Ü–∏–∏ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏
    3. occupied - –µ—Å–ª–∏ –í–°–ï —Å—Ç–∞–Ω—Ü–∏–∏ –∑–∞–Ω—è—Ç—ã
    4. available - –µ—Å–ª–∏ –í–°–ï —Å—Ç–∞–Ω—Ü–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã
    5. partial - –µ—Å–ª–∏ –µ—Å—Ç—å –∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∏ –∑–∞–Ω—è—Ç—ã–µ
    """
```

**–°—Ç–∞—Ç—É—Å—ã –ª–æ–∫–∞—Ü–∏–∏:**
- `available` - –≤—Å–µ —Å—Ç–∞–Ω—Ü–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã
- `occupied` - –≤—Å–µ —Å—Ç–∞–Ω—Ü–∏–∏ –∑–∞–Ω—è—Ç—ã
- `offline` - –µ—Å—Ç—å –æ—Ñ–ª–∞–π–Ω —Å—Ç–∞–Ω—Ü–∏–∏
- `maintenance` - –µ—Å—Ç—å —Å—Ç–∞–Ω—Ü–∏–∏ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏
- `partial` - –µ—Å—Ç—å –∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –∏ –∑–∞–Ω—è—Ç—ã–µ

**–°—Ç–∞—Ç—É—Å—ã —Å—Ç–∞–Ω—Ü–∏–∏:**
- `available` - –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã
- `occupied` - –≤—Å–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã –∑–∞–Ω—è—Ç—ã
- `offline` - –Ω–µ—Ç heartbeat > 5 –º–∏–Ω—É—Ç
- `maintenance` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞

**–°—Ç–∞—Ç—É—Å—ã –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ (OCPP):**
- `Available` - —Å–≤–æ–±–æ–¥–µ–Ω –¥–ª—è –∑–∞—Ä—è–¥–∫–∏
- `Preparing` - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞—Ä—è–¥–∫–µ
- `Charging` - –∏–¥–µ—Ç –∑–∞—Ä—è–¥–∫–∞
- `SuspendedEVSE` - –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å—Ç–∞–Ω—Ü–∏–µ–π
- `SuspendedEV` - –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —ç–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª–µ–º
- `Finishing` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞—Ä—è–¥–∫–∏
- `Reserved` - –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω
- `Unavailable` - –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- `Faulted` - –æ—à–∏–±–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è —Å–ø–∏—Å–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (Supabase + WebSocket)
2. **–î–ª—è –¥–µ—Ç–∞–ª–µ–π**: REST API `/api/v1/station/status/:id` + polling
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å–ø–∏—Å–∫–∞, 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
4. **Offline —Ä–µ–∂–∏–º**: –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞

---

## 3. Endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –≤—Å–µ—Ö —Å—Ç–∞–Ω—Ü–∏–π —Å—Ä–∞–∑—É

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**Endpoint**: `GET /api/v1/locations?include_status=true`

**–ö–æ–¥**: `/backend/app/api/v1/locations/locations.py`

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏–π —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
const response = await fetch(
  'https://ocpp.evpower.kg/api/v1/locations?include_status=true'
);

const data = await response.json();

// Response:
{
  "success": true,
  "locations": [
    {
      "id": "EVP-LOC-001",
      "name": "–¢–¶ –î–æ—Ä–¥–æ–π –ü–ª–∞–∑–∞",
      "address": "—É–ª. –ú–æ—Å–∫–æ–≤—Å–∫–∞—è, 123",
      "city": "–ë–∏—à–∫–µ–∫",
      "country": "–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω",
      "coordinates": {
        "latitude": 42.8746,
        "longitude": 74.5698
      },
      "status": "available",  // üî• –ê–∫—Ç—É–∞–ª—å–Ω—ã–π real-time —Å—Ç–∞—Ç—É—Å
      "stations_summary": {
        "total": 3,
        "available": 2,
        "occupied": 1,
        "offline": 0,
        "maintenance": 0
      },
      "connectors_summary": {
        "total": 6,
        "available": 4,
        "occupied": 2,
        "faulted": 0
      },
      // üî• –°—Ç–∞–Ω—Ü–∏–∏ –≤–∫–ª—é—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ include_stations=true
      "stations": [
        {
          "id": "EVP-001-01",
          "serial_number": "EVPCS-001",
          "model": "ChargePoint Express 250",
          "status": "available",
          "power_capacity": 22.0,
          "connectors_count": 2,
          "tariff": {
            "price_per_kwh": 13.5,
            "session_fee": 0,
            "currency": "KGS"
          },
          "connectors_summary": {
            "available": 2,
            "occupied": 0,
            "faulted": 0
          }
        }
      ]
    }
  ],
  "total_locations": 1,
  "cached": false
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

```typescript
// –¢–æ–ª—å–∫–æ –ª–æ–∫–∞—Ü–∏–∏ –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π —Å—Ç–∞–Ω—Ü–∏–π (–±—ã—Å—Ç—Ä–æ)
GET /api/v1/locations

// –õ–æ–∫–∞—Ü–∏–∏ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞–Ω—Ü–∏—è—Ö
GET /api/v1/locations?include_stations=true

// –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è —Å –¥–µ—Ç–∞–ª—è–º–∏
GET /api/v1/locations?location_id=EVP-LOC-001&include_stations=true

// –ü–æ –≥–æ—Ä–æ–¥—É
GET /api/v1/locations?city=–ë–∏—à–∫–µ–∫&include_stations=true
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

- **TTL**: 30 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `location_status_service.py:22`)
- **–ö–ª—é—á –∫—ç—à–∞**: `locations_status:all` –¥–ª—è –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏–π
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: Redis

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç endpoint –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π**, –∑–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π. –≠—Ç–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö.

---

## 4. –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤

### –¢–µ–∫—É—â–µ–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ - —ç—Ç–æ –ù–û–†–ú–ê

**–°–∏—Ç—É–∞—Ü–∏—è:**
- `connectors_count: 3` –Ω–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `connectors` —Ç–æ–ª—å–∫–æ 2 –∑–∞–ø–∏—Å–∏
- `connector_types: ["GBT", "GBT"]` - –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ç–∏–ø—ã

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ

1. **`connectors_count`** - —ç—Ç–æ **—Ñ–∏–∑–∏—á–µ—Å–∫–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞–Ω—Ü–∏–∏** (—Å–∫–æ–ª—å–∫–æ —Ä–æ–∑–µ—Ç–æ–∫ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ)
2. **–ó–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `connectors`** - —ç—Ç–æ **–∞–∫—Ç–∏–≤–Ω—ã–µ/–Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã** –≤ —Å–∏—Å—Ç–µ–º–µ
3. **`connector_types`** - –º–∞—Å—Å–∏–≤ —Ç–∏–ø–æ–≤ **–∞–∫—Ç–∏–≤–Ω—ã—Ö** –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã)

### –ü—Ä–∏–º–µ—Ä –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏

```typescript
// –°—Ç–∞–Ω—Ü–∏—è EVP-001-01
{
  "connectors_count": 3,  // –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ 3 —Ä–æ–∑–µ—Ç–∫–∏

  // –ù–æ –≤ –ë–î —Ç–æ–ª—å–∫–æ 2 –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω—ã:
  "connectors": [
    { "connector_number": 1, "connector_type": "GBT", "status": "available" },
    { "connector_number": 2, "connector_type": "GBT", "status": "available" }
    // –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä 3 –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω
  ],

  // –ü–æ—ç—Ç–æ–º—É connector_types —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–∏–ø—ã –∞–∫—Ç–∏–≤–Ω—ã—Ö:
  "connector_types": ["GBT", "GBT"]
}
```

### –ü—Ä–∞–≤–∏–ª–∞

‚úÖ **–ù–æ—Ä–º–∞–ª—å–Ω–æ:**
- `connectors_count > –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ connectors` - —á–∞—Å—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω–∞
- `connector_types` —Å–æ–¥–µ—Ä–∂–∏—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã - –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞
- –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ (1, 2, 5 –±–µ–∑ 3, 4) - –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã 3 –∏ 4 –æ—Ç–∫–ª—é—á–µ–Ω—ã

‚ùå **–û—à–∏–±–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏):**
- `connectors_count < –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ connectors` - –æ—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `connector_number > connectors_count` - –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è UI

```typescript
// –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –î–û–°–¢–£–ü–ù–´–• –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤:
const availableConnectors = station.connectors.filter(
  c => c.status === 'available'
).length;

// –î–ª—è –∏–∫–æ–Ω–æ–∫ —Ç–∏–ø–æ–≤ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ unique —Ç–∏–ø—ã:
const uniqueTypes = [...new Set(station.connector_types)];
// ["GBT", "GBT"] ‚Üí ["GBT"]

// –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–∏–ø—É - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π –º–∞—Å—Å–∏–≤:
const hasGBT = station.connector_types.includes("GBT");
```

---

## 5. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ client_id

### ‚úÖ –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ –ü–†–ê–í–ò–õ–¨–ù–´–ô

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ú–æ–±–∏–ª—å–Ω–æ–µ         ‚îÇ
‚îÇ  –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ 1. SMS OTP / Email
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Supabase Auth     ‚îÇ  ‚Üê –í—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–¥–µ—Å—å
‚îÇ  (JWT —Ç–æ–∫–µ–Ω—ã)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ 2. –ü–æ–ª—É—á–∞–µ–º user.id (UUID)
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  client_id =       ‚îÇ
‚îÇ  user.id           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ 3. –ü–µ—Ä–µ–¥–∞–µ–º –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  EvPower OCPP API  ‚îÇ  ‚Üê –ù–ï–¢ —Å–≤–æ–µ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ  (Backend)         ‚îÇ     –î–æ–≤–µ—Ä—è–µ—Ç client_id
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```typescript
// 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  'https://YOUR_PROJECT.supabase.co',
  'YOUR_ANON_KEY'
);

// 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (SMS OTP)
const { data, error } = await supabase.auth.signInWithOtp({
  phone: '+996555123456'
});

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ –∏–∑ SMS
const { data: session, error: verifyError } = await supabase.auth.verifyOtp({
  phone: '+996555123456',
  token: '123456',
  type: 'sms'
});

// 3. –ü–æ–ª—É—á–∞–µ–º client_id
const userId = session.user.id; // UUID
const clientId = userId; // client_id = user.id

// 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
await AsyncStorage.setItem('client_id', clientId);

// 5. –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ EvPower API
const startCharging = async () => {
  const response = await fetch('https://ocpp.evpower.kg/api/v1/charging/start', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      // ‚ö†Ô∏è –ù–ï –ù–£–ñ–ù–´ —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è EvPower API
    },
    body: JSON.stringify({
      client_id: clientId,  // ‚úÖ –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–µ–º client_id
      station_id: 'EVP-001-01',
      connector_id: 1,
      energy_kwh: 10
    })
  });
};
```

### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ù–ï–¢ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** –≤ —Å–∏—Å—Ç–µ–º–µ EvPower - client_id —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
2. **–ù–ï–¢ JWT —Ç–æ–∫–µ–Ω–æ–≤** –¥–ª—è EvPower API - —Ç–æ–ª—å–∫–æ –¥–ª—è Supabase
3. **–ù–ï –ù–£–ñ–ù–û** –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `Authorization` header –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ EvPower API
4. **client_id = Supabase User UUID** - —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–≤–µ—Ä—è–µ—Ç client_id** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è MVP, –Ω–æ –¥–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º:

```typescript
// –ë—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):
// –î–æ–±–∞–≤–∏—Ç—å Supabase JWT –≤ header –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
headers: {
  'Content-Type': 'application/json',
  'Authorization': `Bearer ${session.access_token}`, // Supabase JWT
}

// Backend –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
// 1. JWT –≤–∞–ª–∏–¥–Ω—ã–π?
// 2. client_id –≤ body —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å user.id –∏–∑ JWT?
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–∞

–ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `clients` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```typescript
// –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –ª—é–±–æ–º—É endpoint (–Ω–∞–ø—Ä–∏–º–µ—Ä, /balance)
const response = await fetch(
  `https://ocpp.evpower.kg/api/v1/balance/${clientId}`
);

// –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Ç –≤ –ë–î - —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
// INSERT INTO clients (id, balance, status, created_at)
// VALUES (client_id, 0, 'active', NOW());
```

---

## 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

### –õ–æ–≥–∏–∫–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è

**–ö–æ–¥**: `/backend/app/api/v1/charging/service.py:207-311`

```typescript
// –°—Ü–µ–Ω–∞—Ä–∏–π 1: –õ–∏–º–∏—Ç –ø–æ —ç–Ω–µ—Ä–≥–∏–∏
{
  "client_id": "uuid",
  "station_id": "EVP-001-01",
  "connector_id": 1,
  "energy_kwh": 20  // –•–æ—á—É 20 –∫–í—Ç‚ãÖ—á
}

// Backend —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç:
// estimated_cost = (20 –∫–í—Ç‚ãÖ—á √ó 13.5 —Å–æ–º/–∫–í—Ç‚ãÖ—á) + session_fee
// estimated_cost = 270 + 0 = 270 —Å–æ–º
//
// –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è: 270 —Å–æ–º
// –õ–∏–º–∏—Ç: 20 –∫–í—Ç‚ãÖ—á (–∑–∞—Ä—è–¥–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏)

// –û—Ç–≤–µ—Ç:
{
  "success": true,
  "reserved_amount": 270,
  "limit_type": "energy",
  "limit_value": 20,
  "rate_per_kwh": 13.5,
  "session_fee": 0
}

// –°—Ü–µ–Ω–∞—Ä–∏–π 2: –õ–∏–º–∏—Ç –ø–æ —Å—É–º–º–µ
{
  "client_id": "uuid",
  "station_id": "EVP-001-01",
  "connector_id": 1,
  "amount_som": 100  // –•–æ—á—É –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å 100 —Å–æ–º
}

// Backend —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç:
// max_energy = (100 —Å–æ–º - session_fee) / rate_per_kwh
// max_energy = 100 / 13.5 = 7.4 –∫–í—Ç‚ãÖ—á
//
// –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è: 100 —Å–æ–º
// –õ–∏–º–∏—Ç: 100 —Å–æ–º (–∑–∞—Ä—è–¥–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Å—É–º–º—ã)

// –û—Ç–≤–µ—Ç:
{
  "success": true,
  "reserved_amount": 100,
  "limit_type": "amount",
  "limit_value": 100,
  "rate_per_kwh": 13.5,
  "estimated_energy": 7.4  // –ü—Ä–∏–º–µ—Ä–Ω–æ —Å—Ç–æ–ª—å–∫–æ –∑–∞—Ä—è–¥–∏—Ç—Å—è
}

// –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
{
  "client_id": "uuid",  // –ë–∞–ª–∞–Ω—Å: 50 —Å–æ–º
  "station_id": "EVP-001-01",
  "connector_id": 1,
  "energy_kwh": 20  // –ù—É–∂–Ω–æ: 270 —Å–æ–º
}

// –û—Ç–≤–µ—Ç:
{
  "success": false,
  "error": "insufficient_balance",
  "message": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ë–∞–ª–∞–Ω—Å: 50 —Å–æ–º, —Ç—Ä–µ–±—É–µ—Ç—Å—è: 270 —Å–æ–º",
  "current_balance": 50,
  "required_amount": 270
}
```

### –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

**Q: `required_amount` - —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –∑–∞—Ä—è–¥–∫–∏?**
A: –ù–µ—Ç, —ç—Ç–æ **—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–æ–≥–ª–∞—Å–Ω–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ª–∏–º–∏—Ç—É**. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–æ 20 –∫–í—Ç‚ãÖ—á, —Ç–æ `required_amount = 20 √ó rate_per_kwh + session_fee`.

**Q: –ò–ª–∏ —ç—Ç–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ–π –∑–∞—Ä—è–¥–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ª–∏–º–∏—Ç—É?**
A: **–î–∞, –∏–º–µ–Ω–Ω–æ —ç—Ç–æ!** `required_amount` = —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞—Ä—è–¥–∫–∏ –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞.

**Q: –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 100 —Å–æ–º, –Ω–æ –º–∏–Ω–∏–º—É–º 50 —Å–æ–º - –º–æ–∂–µ—Ç –ª–∏ –æ–Ω –Ω–∞—á–∞—Ç—å –∑–∞—Ä—è–¥–∫—É —Å –ª–∏–º–∏—Ç–æ–º 50 —Å–æ–º?**
A: **–î–∞, –∫–æ–Ω–µ—á–Ω–æ!** –ù–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:

```typescript
// –í–∞—Ä–∏–∞–Ω—Ç 1: –£–∫–∞–∑–∞—Ç—å —Å—É–º–º—É 50 —Å–æ–º
{
  "amount_som": 50
}
// –ó–∞—Ä—è–¥–∏—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 50/13.5 = 3.7 –∫–í—Ç‚ãÖ—á

// –í–∞—Ä–∏–∞–Ω—Ç 2: –£–∫–∞–∑–∞—Ç—å 3 –∫–í—Ç‚ãÖ—á
{
  "energy_kwh": 3
}
// –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è 3 √ó 13.5 = 40.5 —Å–æ–º

// –í–∞—Ä–∏–∞–Ω—Ç 3: –ë–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è —Å –º–∞–ª—ã–º –±–∞–ª–∞–Ω—Å–æ–º
{
  // –ë–µ–∑ –ª–∏–º–∏—Ç–æ–≤
}
// –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è min(balance, 200) = 100 —Å–æ–º
// ‚ö†Ô∏è –ù–æ –µ—Å—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–æ–º –¥–ª—è –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–π
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã

```python
# –ö–æ–¥: /backend/app/api/v1/charging/service.py:270-289

# –î–ª—è –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–π –∑–∞—Ä—è–¥–∫–∏:
min_reservation = 10.0  # —Å–æ–º

# –î–ª—è –∑–∞—Ä—è–¥–∫–∏ —Å –ª–∏–º–∏—Ç–∞–º–∏:
# –ù–ï–¢ –º–∏–Ω–∏–º—É–º–∞! –ú–æ–∂–Ω–æ –∑–∞—Ä—è–¥–∏—Ç—å —Ö–æ—Ç—å –Ω–∞ 5 —Å–æ–º
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è UI

```typescript
// –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ª–∏–º–∏—Ç–∞
const userBalance = 150; // —Å–æ–º
const ratePerKwh = 13.5; // —Å–æ–º/–∫–í—Ç‚ãÖ—á

// –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–∑—É–Ω–æ–∫ –ø–æ —ç–Ω–µ—Ä–≥–∏–∏
const maxEnergy = userBalance / ratePerKwh; // 11.1 –∫–í—Ç‚ãÖ—á
<Slider
  min={1}
  max={maxEnergy}
  step={0.5}
  value={selectedEnergy}
  label={`${selectedEnergy} –∫–í—Ç‚ãÖ—á ‚âà ${selectedEnergy * ratePerKwh} —Å–æ–º`}
/>

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–∑—É–Ω–æ–∫ –ø–æ —Å—É–º–º–µ
<Slider
  min={10}  // –ú–∏–Ω–∏–º—É–º —Ç–æ–ª—å–∫–æ –¥–ª—è –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–π
  max={userBalance}
  step={10}
  value={selectedAmount}
  label={`${selectedAmount} —Å–æ–º ‚âà ${selectedAmount / ratePerKwh} –∫–í—Ç‚ãÖ—á`}
/>

// –í–∞—Ä–∏–∞–Ω—Ç 3: –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä
<QuickSelect>
  <Button>25% ({userBalance * 0.25} —Å–æ–º)</Button>
  <Button>50% ({userBalance * 0.5} —Å–æ–º)</Button>
  <Button>100% (–í–µ—Å—å –±–∞–ª–∞–Ω—Å)</Button>
</QuickSelect>
```

---

## 7. –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∑–∞—Ä—è–¥–∫–∏

### ‚úÖ –í–∞—à–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ü–†–ê–í–ò–õ–¨–ù–û–ï

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –î–æ –∑–∞—Ä—è–¥–∫–∏                                              ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ –ë–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞: 500 —Å–æ–º                                     ‚îÇ
‚îÇ –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: 500 —Å–æ–º                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚îÇ POST /charging/start
                          ‚îÇ { energy_kwh: 20 }
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–∞—Å—á–µ—Ç: 20 √ó 13.5 = 270 —Å–æ–º)          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ UPDATE clients SET balance = 500 - 270 = 230              ‚îÇ
‚îÇ INSERT INTO payment_transactions                            ‚îÇ
‚îÇ   type: 'charge_reserve'                                   ‚îÇ
‚îÇ   amount: -270                                             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ –ë–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞: 230 —Å–æ–º (–≤ –ë–î)                            ‚îÇ
‚îÇ –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ: 270 —Å–æ–º (–≤ —Å–µ—Å—Å–∏–∏)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚îÇ –ó–∞—Ä—è–¥–∫–∞ –∏–¥–µ—Ç...
                          ‚îÇ –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–æ: 15 –∫–í—Ç‚ãÖ—á
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–∞—Å—á–µ—Ç: 15 √ó 13.5 = 202.5 —Å–æ–º)             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ actual_cost = 202.5 —Å–æ–º                                    ‚îÇ
‚îÇ reserved = 270 —Å–æ–º                                         ‚îÇ
‚îÇ refund = 270 - 202.5 = 67.5 —Å–æ–º                           ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ UPDATE clients SET balance = 230 + 67.5 = 297.5           ‚îÇ
‚îÇ INSERT INTO payment_transactions                            ‚îÇ
‚îÇ   type: 'charge_refund'                                    ‚îÇ
‚îÇ   amount: +67.5                                            ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ UPDATE charging_sessions                                    ‚îÇ
‚îÇ   amount = 202.5                                           ‚îÇ
‚îÇ   energy = 15                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. –§–∏–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å                                        ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ –ë—ã–ª–æ: 500 —Å–æ–º                                              ‚îÇ
‚îÇ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 202.5 —Å–æ–º                                       ‚îÇ
‚îÇ –û—Å—Ç–∞–ª–æ—Å—å: 297.5 —Å–æ–º ‚úÖ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°—Ü–µ–Ω–∞—Ä–∏–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–æ –º–µ–Ω—å—à–µ —Ä–µ–∑–µ—Ä–≤–∞ (—Ç–∏–ø–∏—á–Ω—ã–π)

```typescript
// –°—Ç–∞—Ä—Ç
balance: 500 —Å–æ–º
reserved: 270 —Å–æ–º (20 –∫–í—Ç‚ãÖ—á)
available: 230 —Å–æ–º

// –°—Ç–æ–ø (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ 15 –∫–í—Ç‚ãÖ—á)
actual_cost: 202.5 —Å–æ–º
refund: 67.5 —Å–æ–º
new_balance: 297.5 —Å–æ–º ‚úÖ

// –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î:
[
  { type: 'charge_reserve', amount: -270, balance_after: 230 },
  { type: 'charge_refund', amount: +67.5, balance_after: 297.5 }
]
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–æ –±–æ–ª—å—à–µ —Ä–µ–∑–µ—Ä–≤–∞ (—Ä–µ–¥–∫–æ)

```typescript
// –°—Ç–∞—Ä—Ç
balance: 500 —Å–æ–º
reserved: 270 —Å–æ–º (20 –∫–í—Ç‚ãÖ—á)
available: 230 —Å–æ–º

// –°—Ç–æ–ø (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ 25 –∫–í—Ç‚ãÖ—á) - –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∏–∑-–∑–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
actual_cost: 337.5 —Å–æ–º
additional_charge: 67.5 —Å–æ–º

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è –¥–æ–ø–ª–∞—Ç—ã
if (available_balance >= additional_charge) {
  // –°–ø–∏—Å—ã–≤–∞–µ–º –¥–æ–ø–ª–∞—Ç—É
  new_balance: 230 - 67.5 = 162.5 —Å–æ–º ‚úÖ
} else {
  // –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –¥–æ–ø–ª–∞—Ç—ã - —Å–ø–∏—Å—ã–≤–∞–µ–º —á—Ç–æ –µ—Å—Ç—å
  additional_charge = available_balance;
  new_balance: 0 —Å–æ–º
  // –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å (–¥–æ–ª–≥)
}

// –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î:
[
  { type: 'charge_reserve', amount: -270, balance_after: 230 },
  { type: 'charge_payment', amount: -67.5, balance_after: 162.5 }
]
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–æ —Ä–æ–≤–Ω–æ —Ä–µ–∑–µ—Ä–≤

```typescript
// –°—Ç–∞—Ä—Ç
balance: 500 —Å–æ–º
reserved: 270 —Å–æ–º (20 –∫–í—Ç‚ãÖ—á)
available: 230 —Å–æ–º

// –°—Ç–æ–ø (—Ä–æ–≤–Ω–æ 20 –∫–í—Ç‚ãÖ—á)
actual_cost: 270 —Å–æ–º
refund: 0 —Å–æ–º
additional_charge: 0 —Å–æ–º
new_balance: 230 —Å–æ–º ‚úÖ

// –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î:
[
  { type: 'charge_reserve', amount: -270, balance_after: 230 }
  // –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
]
```

### –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

**Q: –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ?**
A: **–î–∞, –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –∑–∞—Ä—è–¥–∫–∞ ‚Üí —Ä–∞—Å—á–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –æ—Å—Ç–∞—Ç–∫–∞ (–∏–ª–∏ –¥–æ–ø–ª–∞—Ç–∞).

**Q: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ "–∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—É—é" —Å—É–º–º—É –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞?**
A: **–î–∞, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å!** –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å.

```typescript
// –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π UI –≤–æ –≤—Ä–µ–º—è –∑–∞—Ä—è–¥–∫–∏
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –í–∞—à –±–∞–ª–∞–Ω—Å                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –î–æ—Å—Ç—É–ø–Ω–æ:     230 —Å–æ–º            ‚îÇ
‚îÇ –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ: 270 —Å–æ–º         ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ          ‚îÇ
‚îÇ –í—Å–µ–≥–æ:        500 —Å–æ–º            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

// –ò–ª–∏ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ:
"–ë–∞–ª–∞–Ω—Å: 230 —Å–æ–º (+ 270 —Å–æ–º –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ)"

// –ü–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ó–∞—Ä—è–¥–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–æ:   15 –∫–í—Ç‚ãÖ—á           ‚îÇ
‚îÇ –°—Ç–æ–∏–º–æ—Å—Ç—å:    202.5 —Å–æ–º          ‚îÇ
‚îÇ –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ:   67.5 —Å–æ–º           ‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: 297.5 —Å–æ–º ‚úÖ       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Q: –ò–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å?**
A: **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —ç–∫—Ä–∞–Ω–∞:**

- **–≠–∫—Ä–∞–Ω "–ë–∞–ª–∞–Ω—Å"**: –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –¥–µ—Ç–∞–ª–∏ (–¥–æ—Å—Ç—É–ø–Ω–æ + –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ)
- **–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω**: –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å
- **–≠–∫—Ä–∞–Ω –∑–∞—Ä—è–¥–∫–∏**: –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–∏

```typescript
// GET /api/v1/charging/status/{session_id}
{
  "success": true,
  "session_id": "uuid",
  "status": "started",

  // –§–∏–Ω–∞–Ω—Å—ã
  "reserved_amount": 270,           // –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  "current_cost": 135,              // –¢–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
  "energy_consumed": 10,            // –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–æ –∫–í—Ç‚ãÖ—á
  "rate_per_kwh": 13.5,

  // –ü—Ä–æ–≥—Ä–µ—Å—Å
  "limit_type": "energy",
  "limit_value": 20,
  "limit_percentage": 50,           // 10 –∏–∑ 20 –∫–í—Ç‚ãÖ—á = 50%

  "duration_minutes": 25
}

// –ü–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (status: "stopped"):
{
  "status": "stopped",
  "reserved_amount": 270,
  "final_cost": 202.5,              // –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
  "refunded_amount": 67.5,          // –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ
  "energy_consumed": 15
}
```

### –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ**: `/backend/app/api/v1/charging/service.py:345-350`
**–í–æ–∑–≤—Ä–∞—Ç**: `/backend/app/api/v1/charging/service.py:642-665`
**–î–æ–ø–ª–∞—Ç–∞**: `/backend/app/api/v1/charging/service.py:667-690`

---

## 8. –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏ –≤ API

### –°—Ç–∞–Ω–¥–∞—Ä—Ç: ISO 8601 —Å timezone

**–§–æ—Ä–º–∞—Ç**: `YYYY-MM-DDTHH:MM:SS.ffffffZ` –∏–ª–∏ `YYYY-MM-DDTHH:MM:SS.ffffff+00:00`

```typescript
// –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:
{
  "start_time": "2025-09-30T12:34:56.789000Z",        // UTC —Å Z
  "stop_time": "2025-09-30T13:45:12.123456+00:00",   // UTC —Å +00:00
  "created_at": "2025-09-30T18:00:00+06:00",         // –ë–∏—à–∫–µ–∫ UTC+6
  "last_heartbeat": "2025-09-30T12:00:00Z"           // UTC
}
```

### Timezone

**Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç**:
- **–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**: UTC (–±–µ–∑ timezone –≤ PostgreSQL, –Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ UTC)
- **–í–æ–∑–≤—Ä–∞—Ç –≤ API**: UTC —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `Z` –∏–ª–∏ `+00:00`
- **–†–∞—Å—á–µ—Ç—ã**: `datetime.now(timezone.utc)` –≤–µ–∑–¥–µ –≤ –∫–æ–¥–µ

**–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ë–∏—à–∫–µ–∫–∞**: UTC+6 (–±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –ª–µ—Ç–Ω–µ–µ –≤—Ä–µ–º—è)

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

```typescript
// 1. –ü–æ–ª—É—á–∞–µ–º –æ—Ç API (–≤—Å–µ–≥–¥–∞ UTC)
const response = await fetch('/api/v1/charging/status/uuid');
const data = await response.json();

// data.start_time = "2025-09-30T12:00:00Z"

// 2. –ü–∞—Ä—Å–∏–º –≤ Date –æ–±—ä–µ–∫—Ç
const startTime = new Date(data.start_time);
// JavaScript –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç ISO 8601

// 3. –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
// –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π timezone —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
const localTime = startTime.toLocaleString('ru-RU', {
  timeZone: 'Asia/Bishkek',  // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –ë–∏—à–∫–µ–∫
  year: 'numeric',
  month: '2-digit',
  day: '2-digit',
  hour: '2-digit',
  minute: '2-digit',
  second: '2-digit'
});
// "30.09.2025, 18:00:00" (UTC+6)

// –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É date-fns
import { format, parseISO } from 'date-fns';
import { utcToZonedTime } from 'date-fns-tz';

const utcDate = parseISO(data.start_time);
const bishkekDate = utcToZonedTime(utcDate, 'Asia/Bishkek');
const formatted = format(bishkekDate, 'dd.MM.yyyy HH:mm');
// "30.09.2025 18:00"

// –í–∞—Ä–∏–∞–Ω—Ç C: –î–ª—è React Native - –∏—Å–ø–æ–ª—å–∑—É–µ–º moment-timezone
import moment from 'moment-timezone';

const momentDate = moment.utc(data.start_time);
const bishkekTime = momentDate.tz('Asia/Bishkek');
const formatted = bishkekTime.format('DD.MM.YYYY HH:mm');
// "30.09.2025 18:00"
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞—Ç –≤ API

```typescript
// –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø! –í—Å–µ –¥–∞—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ backend
// –ù–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è):

const userBirthday = new Date('1990-05-15');
const isoString = userBirthday.toISOString();
// "1990-05-15T00:00:00.000Z"

await fetch('/api/user/profile', {
  method: 'PUT',
  body: JSON.stringify({
    birthday: isoString  // ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ISO 8601
  })
});
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π timezone –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
2. **–•—Ä–∞–Ω–∏—Ç–µ –≤ UTC** –ª–æ–∫–∞–ª—å–Ω–æ –≤ –∫—ç—à–µ/–±–∞–∑–µ
3. **–î–ª—è –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Asia/Bishkek` timezone (UTC+6)
4. **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏**:
   - React Native: `moment-timezone` –∏–ª–∏ `date-fns-tz`
   - Flutter: `intl` package
   - Swift: `DateFormatter` —Å `timeZone`
   - Kotlin: `java.time.ZonedDateTime`

### –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

```typescript
// –î–ª—è "5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥", "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥"
import { formatDistanceToNow } from 'date-fns';
import { ru } from 'date-fns/locale';

const lastHeartbeat = parseISO(station.last_heartbeat);
const relativeTime = formatDistanceToNow(lastHeartbeat, {
  addSuffix: true,
  locale: ru
});
// "5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥"

// –ò–ª–∏ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞—Ä—è–¥–∫–∏:
const duration = intervalToDuration({
  start: parseISO(session.start_time),
  end: new Date()
});

const formatted = `${duration.hours}—á ${duration.minutes}–º`;
// "1—á 25–º"
```

---

## 9. Rate limiting –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### ‚ùå Rate Limiting –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏

**–°—Ç–∞—Ç—É—Å**: –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–ª—è v1.1

**–ö–æ–¥**: `/backend/app/core/config.py` - –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ rate limiting

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```yaml
# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–∏–º–∏—Ç—ã (–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏):
Max Request Size: 10 MB
Connection Timeout: 30 —Å–µ–∫—É–Ω–¥
WebSocket Idle Timeout: 60 —Å–µ–∫—É–Ω–¥
Max Active Sessions: –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–Ω–∞ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞)

# OCPP –ª–∏–º–∏—Ç—ã:
Station Heartbeat Timeout: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
Station Heartbeat Interval: 60 —Å–µ–∫—É–Ω–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

# –ö—ç—à –ª–∏–º–∏—Ç—ã:
Location Cache TTL: 30 —Å–µ–∫—É–Ω–¥
Pricing Cache TTL: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)

# –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –ª–∏–º–∏—Ç—ã:
QR Code Lifetime: 5 –º–∏–Ω—É—Ç
Invoice Lifetime: 5 –º–∏–Ω—É—Ç
Payment Check Interval: 15 —Å–µ–∫—É–Ω–¥
Payment Max Checks: 20 (–∏—Ç–æ–≥–æ 5 –º–∏–Ω—É—Ç)
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

```typescript
// –†–µ–∞–ª–∏–∑—É–π—Ç–µ rate limiting –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞:

// 1. Throttling –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å—Ç–∞—Ç—É—Å–∞
let lastStatusCheck = 0;
const MIN_STATUS_INTERVAL = 10000; // 10 —Å–µ–∫—É–Ω–¥

async function checkChargingStatus(sessionId) {
  const now = Date.now();
  if (now - lastStatusCheck < MIN_STATUS_INTERVAL) {
    return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å
  }

  lastStatusCheck = now;
  const status = await fetch(`/api/v1/charging/status/${sessionId}`);
  // ...
}

// 2. Debouncing –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π
import { debounce } from 'lodash';

const searchStations = debounce(async (query) => {
  const results = await fetch(`/api/v1/locations?search=${query}`);
  // ...
}, 500); // 500ms –∑–∞–¥–µ—Ä–∂–∫–∞

// 3. Exponential backoff –¥–ª—è –æ—à–∏–±–æ–∫
let retryCount = 0;
const MAX_RETRIES = 5;

async function startChargingWithRetry(data) {
  try {
    const response = await fetch('/api/v1/charging/start', {
      method: 'POST',
      body: JSON.stringify(data)
    });

    if (!response.ok) throw new Error('Failed');

    retryCount = 0; // –°–±—Ä–æ—Å –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
    return await response.json();

  } catch (error) {
    if (retryCount < MAX_RETRIES) {
      const delay = Math.pow(2, retryCount) * 1000; // 1s, 2s, 4s, 8s, 16s
      retryCount++;

      await new Promise(resolve => setTimeout(resolve, delay));
      return startChargingWithRetry(data);
    }

    throw error;
  }
}
```

### Response –∫–æ–¥—ã (–µ—Å–ª–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω rate limiting)

```typescript
// 429 Too Many Requests (–ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û —Å–µ–π—á–∞—Å)
{
  "error": "rate_limit_exceeded",
  "message": "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥",
  "retry_after": 60 // —Å–µ–∫—É–Ω–¥—ã
}

// Headers (–ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è):
X-RateLimit-Limit: 100       // –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–∫–Ω–µ
X-RateLimit-Remaining: 85    // –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤
X-RateLimit-Reset: 1696073200 // Unix timestamp —Å–±—Ä–æ—Å–∞ —Å—á–µ—Ç—á–∏–∫–∞
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—Ä—è–¥–∫–∏**: Polling –Ω–µ —á–∞—â–µ 10 —Å–µ–∫—É–Ω–¥
2. **–î–ª—è —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WebSocket, –∞ –Ω–µ polling
3. **–î–ª—è –±–∞–ª–∞–Ω—Å–∞**: –ö—ç—à–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ, –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –ø–æ—Å–ª–µ –ø–ª–∞—Ç–µ–∂–µ–π/–∑–∞—Ä—è–¥–æ–∫
4. **–î–ª—è –æ–ø–ª–∞—Ç—ã**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ - –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã (–º–∞–∫—Å–∏–º—É–º 20 —Ä–∞–∑)
5. **–î–ª—è –∏—Å—Ç–æ—Ä–∏–∏**: Pagination + infinite scroll, –∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–≥–æ —Å—Ä–∞–∑—É

### –ë—É–¥—É—â–∏–µ –ø–ª–∞–Ω—ã (v1.1)

```yaml
–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
  - Rate Limiting: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ client_id
  - Sliding Window Counter –∞–ª–≥–æ—Ä–∏—Ç–º
  - Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤
  - 429 response —Å Retry-After header
  - Whitelist –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```

---

## 10. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ö–æ–¥**: `/backend/app/core/logging_config.py`, `/backend/app/main.py:26-35`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã:
OCPPHandler   - INFO   # OCPP –ø—Ä–æ—Ç–æ–∫–æ–ª –∏ —Å—Ç–∞–Ω—Ü–∏–∏
OCPP          - INFO   # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ocpp
websockets    - INFO   # WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
fastapi       - INFO   # FastAPI —Å–æ–±—ã—Ç–∏—è
uvicorn       - INFO   # HTTP —Å–µ—Ä–≤–µ—Ä
payment       - INFO   # –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–¥–æ–±–∞–≤–ª–µ–Ω PaymentAuditMiddleware)
security      - INFO   # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–¥–æ–±–∞–≤–ª–µ–Ω SecurityMiddleware)
```

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

#### 1. –ó–∞–ø—Ä–æ—Å—ã –æ—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ö–æ–¥**: `/backend/app/core/security_middleware.py`

```python
# –ö–∞–∂–¥—ã–π HTTP –∑–∞–ø—Ä–æ—Å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:
# - Method, URL, client IP
# - Request headers
# - Response status code
# - Duration (–≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

# –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:
[2025-09-30 12:34:56] INFO - POST /api/v1/charging/start - 200 OK - 245ms - IP: 192.168.1.100
```

#### 2. –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ö–æ–¥**: `/backend/app/core/payment_audit.py`

```python
# –ê—É–¥–∏—Ç –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
# - /balance/topup-qr
# - /balance/topup-card
# - /payment/status/*
# - /charging/start (—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ)
# - /charging/stop (—Å–ø–∏—Å–∞–Ω–∏–µ/–≤–æ–∑–≤—Ä–∞—Ç)

# –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:
[2025-09-30 12:35:00] INFO - üí≥ TOPUP: client_id=uuid, amount=100.00, invoice_id=INV123, provider=OBANK
[2025-09-30 12:40:00] INFO - üí≥ CHARGE_RESERVE: session_id=uuid, amount=270.00, client_id=uuid
[2025-09-30 13:00:00] INFO - üí≥ CHARGE_REFUND: session_id=uuid, refund=67.50, client_id=uuid
```

#### 3. OCPP —Å–æ–±—ã—Ç–∏—è

```python
# –í—Å–µ OCPP —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Å—Ç–∞–Ω—Ü–∏–π:
[2025-09-30 12:00:00] INFO - BootNotification: station=EVP-001-01, vendor=ChargePoint, model=Express250
[2025-09-30 12:01:00] INFO - Heartbeat: station=EVP-001-01
[2025-09-30 12:35:00] INFO - StatusNotification: station=EVP-001-01, connector=1, status=Charging
[2025-09-30 12:35:00] INFO - StartTransaction: station=EVP-001-01, connector=1, id_tag=+996555123456
[2025-09-30 13:00:00] INFO - StopTransaction: station=EVP-001-01, transaction_id=123, meter=15000Wh
```

#### 4. –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

```python
# –í—Å–µ –æ—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º traceback:
[2025-09-30 12:35:00] ERROR - –û—à–∏–±–∫–∞ —Å—Ç–∞—Ä—Ç–∞ –∑–∞—Ä—è–¥–∫–∏: Connector not available
Traceback (most recent call last):
  File "/backend/app/api/v1/charging/start.py", line 45, in start_charging
    ...
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –∏ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –ª–æ–≥–æ–≤:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ grep:

# 1. –û—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
docker logs evpower-backend --since 1h 2>&1 | grep ERROR

# 2. –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã /charging/start
docker logs evpower-backend --since 1d 2>&1 | grep "POST /api/v1/charging/start" | grep "200 OK"

# 3. –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
docker logs evpower-backend --since 1d 2>&1 | grep "üí≥"

# 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–æ–¥–∞–º –æ—Ç–≤–µ—Ç–∞
docker logs evpower-backend --since 1d 2>&1 | grep -oP '\d{3} \w+' | sort | uniq -c
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –ë–î:

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—Ä—è–¥–æ–∫ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT
  COUNT(*) as total_sessions,
  COUNT(*) FILTER (WHERE status = 'started') as active,
  COUNT(*) FILTER (WHERE status = 'stopped') as completed,
  COUNT(*) FILTER (WHERE status = 'error') as failed,
  SUM(amount) as total_revenue,
  SUM(energy) as total_energy_kwh
FROM charging_sessions
WHERE DATE(start_time) = CURRENT_DATE;

-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏
SELECT
  s.serial_number,
  COUNT(cs.id) as sessions_count,
  SUM(cs.amount) as revenue
FROM charging_sessions cs
JOIN stations s ON cs.station_id = s.id
WHERE cs.start_time >= NOW() - INTERVAL '7 days'
GROUP BY s.id, s.serial_number
ORDER BY sessions_count DESC
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
SELECT
  DATE(created_at) as date,
  COUNT(*) as transactions_count,
  SUM(amount) FILTER (WHERE amount > 0) as total_topup,
  SUM(ABS(amount)) FILTER (WHERE amount < 0) as total_spent
FROM payment_transactions
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

### Dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**‚ùå –ù–ï–¢ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ dashboard**

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è**:
1. **Grafana** + **Prometheus** - –¥–ª—è –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. **Supabase Dashboard** - –¥–ª—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –¥–∞–Ω–Ω—ã–º
3. **Coolify Logs** - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### –ö—É–¥–∞ –ø–∏—Å–∞—Ç—å –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

```yaml
# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã API:
Email: support@evpower.kg
GitHub Issues: https://github.com/evpower/backend/issues (–µ—Å–ª–∏ –µ—Å—Ç—å)

# –ü—Ä–æ–±–ª–µ–º—ã Supabase:
Supabase Dashboard: https://app.supabase.com/project/YOUR_PROJECT

# –ü—Ä–æ–±–ª–µ–º—ã OCPP —Å—Ç–∞–Ω—Ü–∏–π:
–õ–æ–≥-—Ñ–∞–π–ª—ã: docker logs evpower-backend
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: GET /health
```

### Access to logs

```bash
# –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å SSH –¥–æ—Å—Ç—É–ø:
ssh user@ocpp.evpower.kg

# –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker logs -f evpower-backend

# –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
tail -f /var/log/evpower-ocpp/app.log

# –ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º
grep "client_id=YOUR_UUID" /var/log/evpower-ocpp/app.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ —Å –æ—à–∏–±–∫–∞–º–∏
docker logs evpower-backend 2>&1 | grep ERROR | tail -100
```

---

## 11. –ü–ª–∞–Ω—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é API

### Breaking Changes

**‚ùå –ù–ï –ü–õ–ê–ù–ò–†–£–Æ–¢–°–Ø –≤ –±–ª–∏–∂–∞–π—à–∏–µ 6 –º–µ—Å—è—Ü–µ–≤**

**–ì–∞—Ä–∞–Ω—Ç–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**: –ú–∏–Ω–∏–º—É–º 6 –º–µ—Å—è—Ü–µ–≤ –¥–ª—è v1 API

### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API

```typescript
// –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è
/api/v1/...          // ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è, production ready

// Legacy (deprecated)
/api/...             // ‚ö†Ô∏è Deprecated, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ v1

// –ë—É–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ (–∫–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è)
/api/v2/...          // üîÆ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ major changes
```

### –ü—Ä–∞–≤–∏–ª–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

1. **Minor changes** (–Ω–æ–≤—ã–µ –ø–æ–ª—è, endpoints) - –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é v1
2. **Bug fixes** - –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏
3. **Breaking changes** - —Ç–æ–ª—å–∫–æ –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ (v2, v3...)

### –ö–∞–∫ –±—É–¥—É—Ç –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

```yaml
# 1. CHANGELOG.md –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
https://github.com/evpower/backend/blob/main/CHANGELOG.md

# 2. API Response Header (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
X-API-Version: 1.0
X-API-Deprecated-Warning: "–≠—Ç–æ—Ç endpoint –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –≤ v2 (2026-01-01)"

# 3. Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 3 –º–µ—Å—è—Ü–∞ –¥–æ breaking changes

# 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
https://docs.evpower.kg/api/changelog
```

### Roadmap –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 3-6 –º–µ—Å—è—Ü–µ–≤

#### Q4 2025 (–û–∫—Ç—è–±—Ä—å - –î–µ–∫–∞–±—Ä—å)

```yaml
v1.1 (–ù–æ—è–±—Ä—å 2025):
  –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
    - ‚úÖ Rate Limiting (100 req/min)
    - ‚úÖ Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Firebase
    - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∑–∞—Ä—è–¥–æ–∫ API endpoint (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Supabase)
    - ‚úÖ –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –ª–æ–∫–∞—Ü–∏–π (–ø–æ —Ç–∏–ø—É –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞, –º–æ—â–Ω–æ—Å—Ç–∏)
    - ‚úÖ –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏ (favorites)

  –£–ª—É—á—à–µ–Ω–∏—è:
    - üîß –í–∞–ª–∏–¥–∞—Ü–∏—è client_id —á–µ—Ä–µ–∑ Supabase JWT
    - üîß –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ /charging/status
    - üîß –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–Ω—É—Å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º (loyalty points)

  –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
    - üîí HTTPS –≤–µ–∑–¥–µ (—É–∂–µ –µ—Å—Ç—å)
    - üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook –æ—Ç –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
    - üîí IP whitelist –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö endpoints

v1.2 (–î–µ–∫–∞–±—Ä—å 2025):
  –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
    - üÜï –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–π (reservation)
    - üÜï –ì—Ä—É–ø–ø–æ–≤–∞—è –∑–∞—Ä—è–¥–∫–∞ (split payment)
    - üÜï –ü–æ–¥–ø–∏—Å–∫–∏ (subscription plans)
    - üÜï –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

  –ü–ª–∞—Ç–µ–∂–∏:
    - üí≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã (tokenization)
    - üí≥ Apple Pay / Google Pay
    - üí≥ –ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –±–∞–ª–∞–Ω—Å–µ

  OCPP:
    - ‚ö° OCPP 2.0.1 support (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
    - ‚ö° Smart Charging (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—â–Ω–æ—Å—Ç—å—é)
```

#### Q1 2026 (–Ø–Ω–≤–∞—Ä—å - –ú–∞—Ä—Ç)

```yaml
v1.3:
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π (routes to stations)
  - –ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Ç–∞–Ω—Ü–∏–π (ML)
  - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (peak/off-peak)
  - –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã (fleet management)
  - API –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ (third-party integrations)
```

### Deprecated Features

**–ù–µ—Ç deprecated features –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏**

–ö–æ–≥–¥–∞ –ø–æ—è–≤—è—Ç—Å—è:
```typescript
// –ü—Ä–∏–º–µ—Ä deprecated endpoint (–≤ –±—É–¥—É—â–µ–º)
GET /api/v1/balance/{client_id}
// Headers:
X-Deprecated: true
X-Deprecated-Message: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /api/v2/wallet/balance"
X-Deprecated-Sunset: "2026-06-01"  // –î–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è
```

### –ö–∞–∫ –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```yaml
# 1. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ changelog:
https://docs.evpower.kg/api/changelog/subscribe

# 2. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ response headers:
X-API-Version: 1.0
X-API-Latest-Version: 1.1
X-API-Upgrade-Available: true

# 3. GitHub Watch:
https://github.com/evpower/backend (–µ—Å–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π)

# 4. Email —Ä–∞—Å—Å—ã–ª–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
–û—Ç–ø—Ä–∞–≤—å—Ç–µ email –Ω–∞ dev-subscribe@evpower.kg
```

---

## 12. –¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

### ‚ö†Ô∏è –ù–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ staging –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø–æ–∫–∞)

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è**:
- **Production**: `https://ocpp.evpower.kg` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- **Staging**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ü–æ–¥—Ö–æ–¥ 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –Ω–∞ production

```yaml
# OBANK —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã (—Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ production):
–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞:
  –ù–æ–º–µ—Ä: 4169 5855 1234 5678
  –°—Ä–æ–∫: 12/25
  CVV: 123
  –ò–º—è: TEST CARD

3DS –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
  –ù–æ–º–µ—Ä: 4169 5855 8765 4321
  –°—Ä–æ–∫: 12/25
  CVV: 123
  (–ü–æ—è–≤–∏—Ç—Å—è —ç–∫—Ä–∞–Ω 3DS, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π –∫–æ–¥)

–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞:
  –ù–æ–º–µ—Ä: 4169 5855 1111 1111
  –°—Ä–æ–∫: 12/25
  CVV: 123

# –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º OBANK:
–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç: test-rakhmet.dengi.kg:4431
Point ID: 4354 (—Ç–µ—Å—Ç–æ–≤—ã–π)
Service ID: 1331 (—Ç–µ—Å—Ç–æ–≤—ã–π)
```

#### –ü–æ–¥—Ö–æ–¥ 2: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏

```yaml
# –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ç–∞–Ω—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã):
–°—Ç–∞–Ω—Ü–∏—è: EVP-TEST-01
  Serial: TEST-001
  Location: Test Location
  Connectors: 2 √ó GBT
  –°—Ç–∞—Ç—É—Å: –í—Å–µ–≥–¥–∞ online (—Å–∏–º—É–ª—è—Ç–æ—Ä)

–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç–∞–Ω—Ü–∏–∏:
  1. –°–∫–∞—á–∞–π—Ç–µ OCPP 1.6 —Å–∏–º—É–ª—è—Ç–æ—Ä:
     https://github.com/mobilityhouse/ocpp-simulator

  2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
     URL: ws://ocpp.evpower.kg/ws/YOUR-TEST-STATION-ID
     Protocol: ocpp1.6

  3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ BootNotification:
     {
       "chargePointVendor": "Test",
       "chargePointModel": "Simulator"
     }
```

#### –ü–æ–¥—Ö–æ–¥ 3: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ client_id

```typescript
// –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Supabase:
const { data, error } = await supabase.auth.signUp({
  email: 'test+' + Date.now() + '@evpower.kg',
  password: 'TestPass123!',
  options: {
    data: {
      name: 'Test User',
      phone: '+996555000001'  // –¢–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä
    }
  }
});

const testClientId = data.user.id;

// –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É:
await fetch('https://ocpp.evpower.kg/api/v1/balance/topup-card', {
  method: 'POST',
  body: JSON.stringify({
    client_id: testClientId,
    amount: 1000,  // –¢–µ—Å—Ç–æ–≤–∞—è —Å—É–º–º–∞
    card_pan: '4169585512345678',  // –¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞
    // ...
  })
});
```

### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è: Staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ (Q4 2025)

```yaml
Staging URL (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):
  API: https://staging.ocpp.evpower.kg
  WebSocket: wss://staging.ocpp.evpower.kg
  –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –û—Ç–¥–µ–ª—å–Ω–∞—è Supabase project (staging)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
  - –ö–æ–ø–∏—è production –¥–∞–Ω–Ω—ã—Ö (anonymized)
  - –¢–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —à–ª—é–∑—ã
  - –°–∏–º—É–ª—è—Ç–æ—Ä—ã —Å—Ç–∞–Ω—Ü–∏–π
  - –ë—ã—Å—Ç—Ä—ã–π reset –¥–∞–Ω–Ω—ã—Ö
  - Swagger UI enabled (–≤ staging)

–î–æ—Å—Ç—É–ø:
  –ó–∞–ø—Ä–æ—Å–∏—Ç–µ —á–µ—Ä–µ–∑: dev-access@evpower.kg
  –ü–æ–ª—É—á–∏—Ç–µ:
    - staging_client_id
    - staging_api_key
    - –¥–æ—Å—Ç—É–ø –∫ Postman collection
```

### –¢–µ–∫—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è QA

```yaml
1. Unit —Ç–µ—Å—Ç—ã:
   /backend/tests/*.py
   –ó–∞–ø—É—Å–∫: pytest backend/tests/

2. Postman –∫–æ–ª–ª–µ–∫—Ü–∏—è:
   –ó–∞–ø—Ä–æ—Å–∏—Ç–µ: dev@evpower.kg
   –í–∫–ª—é—á–∞–µ—Ç:
     - –í—Å–µ endpoints
     - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
     - –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
     - Environment variables

3. OCPP —Å–∏–º—É–ª—è—Ç–æ—Ä:
   –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: (–∑–∞–ø—Ä–æ—Å–∏—Ç–µ —É –∫–æ–º–∞–Ω–¥—ã)
   –ü–æ–∑–≤–æ–ª—è–µ—Ç:
     - –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–Ω—Ü–∏–∏
     - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ä—è–¥–∫—É
     - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å OCPP –∫–æ–º–∞–Ω–¥—ã

4. Supabase local development:
   npx supabase start
   –õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –ë–î –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

### Best Practices –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ production

```typescript
// 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
const testEmail = `test+${Date.now()}@evpower.kg`;
const testPhone = '+996555999' + Math.floor(Math.random() * 1000);

// 2. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ —Å—É–º–º—ã
const MAX_TEST_AMOUNT = 10; // –ú–∞–∫—Å–∏–º—É–º 10 —Å–æ–º –¥–ª—è —Ç–µ—Å—Ç–æ–≤

// 3. –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
console.log('[TEST]', operation, { clientId, amount, stationId });

// 4. Cleanup –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤
afterEach(async () => {
  // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
  await stopAllTestSessions();

  // –£–¥–∞–ª–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  await cleanupTestData();
});

// 5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ feature flags
const IS_TEST_USER = userEmail.startsWith('test+');
if (IS_TEST_USER) {
  // –û—Å–æ–±–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  enableDebugMode();
}
```

### –ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

```yaml
Email: dev@evpower.kg
Telegram: @evpower_dev
–ó–∞–ø—Ä–æ—Å–∏—Ç–µ:
  - Postman collection
  - OCPP simulator setup
  - –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω—Ü–∏–π
  - –î–æ—Å—Ç—É–ø –∫ staging (–∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è)
```

---

## üìã –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### ‚úÖ –ß—Ç–æ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

- [x] **WebSocket –¥–ª—è –ª–æ–∫–∞—Ü–∏–π** - `wss://ocpp.evpower.kg/api/v1/ws/locations`
- [x] **REST API –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** - –í—Å–µ endpoints `/api/v1/*`
- [x] **–°—Ç–∞—Ç—É—Å—ã —Å—Ç–∞–Ω—Ü–∏–π real-time** - –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- [x] **–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞** - QR (O!Dengi) –∏ –ö–∞—Ä—Ç—ã (OBANK)
- [x] **–ó–∞—Ä—è–¥–∫–∞** - Start/Stop/Status —Å —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- [x] **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** - –ì–∏–±–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã
- [x] **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Supabase** - –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [x] **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã/–ø–ª–∞—Ç–µ–∂–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

### ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è

- [ ] **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Supabase SDK
- [ ] **–ò—Å—Ç–æ—Ä–∏—è –∑–∞—Ä—è–¥–æ–∫** - –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Supabase, –Ω–µ—Ç REST endpoint
- [ ] **–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π** - –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Supabase, –Ω–µ—Ç REST endpoint
- [ ] **Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ WebSocket
- [ ] **Rate Limiting** - –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –¥–µ–ª–∞–π—Ç–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- [ ] **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** - –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –¥–µ–ª–∞–π—Ç–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö**:
   - –°–ø–∏—Å–æ–∫ —Å—Ç–∞–Ω—Ü–∏–π: Supabase + WebSocket –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - –î–µ—Ç–∞–ª–∏ —Å—Ç–∞–Ω—Ü–∏–∏: REST API `/station/status/:id`
   - –ò—Å—Ç–æ—Ä–∏—è: –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase

2. **–ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–∞–∑—É–º–Ω–æ**:
   - –°–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π: 30 —Å–µ–∫—É–Ω–¥
   - –î–µ—Ç–∞–ª–∏ —Å—Ç–∞–Ω—Ü–∏–∏: 10 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞—Ä—è–¥–∫–µ
   - –ë–∞–ª–∞–Ω—Å: –û–±–Ω–æ–≤–ª—è–π—Ç–µ –ø–æ—Å–ª–µ –ø–ª–∞—Ç–µ–∂–µ–π/–∑–∞—Ä—è–¥–æ–∫

3. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ offline —Ä–µ–∂–∏–º**:
   - –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏"
   - Retry —Å exponential backoff

4. **–ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–µ—Ç–∞–ª–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤**:
   - –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ –≤–æ –≤—Ä–µ–º—è –∑–∞—Ä—è–¥–∫–∏
   - –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ—Å–ª–µ –∑–∞—Ä—è–¥–∫–∏
   - –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏

5. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ reconnect –¥–ª—è WebSocket**:
   - Exponential backoff (5s, 10s, 20s...)
   - –ú–∞–∫—Å–∏–º—É–º 5 –ø–æ–ø—ã—Ç–æ–∫
   - –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### üìû –ö–û–ù–¢–ê–ö–¢–´

**–ü–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º API:**
- Email: support@evpower.kg
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –≠—Ç–æ—Ç —Ñ–∞–π–ª + API_INTEGRATION_ANSWERS.md

**–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º Supabase:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://supabase.com/docs
- Dashboard: https://app.supabase.com

**–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º OCPP:**
- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: OCPP 1.6J
- –ö–æ–¥: `/backend/ocpp_ws_server/`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-09-30
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 2.0
**–ê–≤—Ç–æ—Ä**: Backend Team EvPower
**–°—Ç–∞—Ç—É—Å**: Production Ready
